name: CI

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  test:
    strategy:
      max-parallel: 5
      matrix:
        env:
          - py39
          # - py310
          # - py311
          # - py312
        os:
          # - ubuntu-latest
          - windows-latest
          # - macos-latest
    runs-on: ${{ matrix.os }}
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
      - name: Setup pixi
        uses: prefix-dev/setup-pixi@ba3bb36eb2066252b2363392b7739741bb777659 # v0.8.1
        with:
          environments: ${{ matrix.env }}
      - name: Install repository
        run: |
          pixi run -e ${{ matrix.env }} postinstall
      - name: Run tests
        run: |
          pixi run -e ${{ matrix.env }} test --color=yes
      - name: Type checking
        run: |
          pixi run -e ${{ matrix.env }} mypy mkdocs_marimo

  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
      - name: Setup pixi
        uses: prefix-dev/setup-pixi@ba3bb36eb2066252b2363392b7739741bb777659 # v0.8.1
        with:
          environments: lint default
      - name: Lint
        run: |
          pixi run lint-all-check
